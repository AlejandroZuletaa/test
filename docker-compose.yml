version: '3.8'

services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
      target: production  # Usamos el target para el frontend
    ports:
      - "4005:80"  # Para el frontend

  backend:
    build:
      context: .
      dockerfile: Dockerfile
      target: run-backend  # Usamos el target para el backend
    ports:
      - "4004:8000"  # Para el backend
    environment:
      ORIGINS: 'http://localhost:4005'
    volumes:
      - ./backend:/usr/src/app/backend:delegated  # Monta el directorio del backend para desarrollo en tiempo real
      - ./backend/db.sqlite:/usr/src/app/db.sqlite  # Monta el archivo de la base de datos SQLite
      - ./backend/db.sqlite-shm:/usr/src/app/db.sqlite-shm  # Opcionalmente monta el archivo shm
      - ./backend/db.sqlite-wal:/usr/src/app/db.sqlite-wal  # Opcionalmente monta el archivo wal
      - ~/.ssh:/root/.ssh:ro  # Monta tu configuraci√≥n de SSH local
